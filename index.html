<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup Jungsch√ºtzen ‚Äì Cup-Duell</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#eef2f7;margin:0;color:#111827}
.container{max-width:1100px;margin:auto;padding:1rem}
h1{color:#1e3a8a;margin-bottom:1rem}
h2{color:#1d4ed8;margin:.25rem 0}
.card{background:#fff;border-radius:12px;padding:1rem 1.25rem;
box-shadow:0 4px 10px rgba(15,23,42,.08);margin-bottom:1rem}
.row{display:flex;flex-wrap:wrap;gap:.75rem}
.field{flex:1;min-width:200px}
label{font-size:.8rem;font-weight:600}
input,select{width:100%;padding:.45rem;border-radius:8px;
border:1px solid #cbd5f5;background:#f9fafb}
table{width:100%;border-collapse:collapse;font-size:.85rem;margin-top:.5rem}
th,td{border:1px solid #e5e7eb;padding:.35rem;text-align:center}
th{background:#dbeafe}
.sum{background:#f3f4f6;font-weight:600}
button{border:none;border-radius:999px;padding:.5rem 1rem;
cursor:pointer;font-size:.9rem}
.btn{background:#2563eb;color:#fff}
.winner{padding:.6rem;border-radius:999px;font-weight:600}
.none{background:#e5e7eb}
.g1{background:#dcfce7;color:#166534}
.g2{background:#dbeafe;color:#1d4ed8}
.draw{background:#fef9c3;color:#854d0e}
</style>
</head>

<body>
<div class="container">

<h1>Amtscup Jungsch√ºtzen ‚Äì Cup-Duell</h1>

<div class="card">
<h2>1. Gruppenchef & Gruppen</h2>
<div class="row">
  <div class="field">
    <label>Name Gruppenchef</label>
    <input id="chefName">
  </div>
  <div class="field">
    <label>E-Mail</label>
    <input id="chefEmail" type="email">
  </div>
</div>
<div class="row">
  <div class="field">
    <label>Gruppe 1</label>
    <select id="g1"></select>
  </div>
  <div class="field">
    <label>Gruppe 2</label>
    <select id="g2"></select>
  </div>
</div>
</div>

<div id="groups"></div>

<div class="card">
<h2>Vergleich & Sieger</h2>
<div id="winner" class="winner none">Noch keine Resultate</div>
</div>

<div class="card">
<button id="sendBtn" class="btn">üì§ Resultat speichern</button>
</div>

</div>

<script>
/* ====== GOOGLE SHEETS WEB APP ====== */
const GOOGLE_SHEET_URL =
"https://script.google.com/macros/s/AKfycbzOGz9MLOx-laowsREqqmRl7Lr2Wz-_tQ1rxAU4onE-0-yKGdYpVZRImfxJd7loHqm8rg/exec";

/* ====== GRUPPEN LADEN ====== */
function parseGroups(t){
  return t.split(/\r?\n/)
    .map(l=>l.trim())
    .filter(l=>l && !l.startsWith("#"));
}

async function loadGroups(){
  const r = await fetch("gruppen.txt?ts="+Date.now(),{cache:"no-store"});
  const groups = parseGroups(await r.text());
  ["g1","g2"].forEach(id=>{
    const s=document.getElementById(id);
    s.innerHTML="<option value=''>Bitte w√§hlen ‚Ä¶</option>";
    groups.forEach(g=>{
      const o=document.createElement("option");
      o.value=o.textContent=g;
      s.appendChild(o);
    });
  });
}

/* ====== SCH√úTZEN ====== */
function createGroup(n){
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`
  <h2>Sch√ºtzen ‚Äì Gruppe ${n}</h2>
  <table>
    <thead>
      <tr><th>#</th><th>Name*</th><th>Jahrgang*</th><th>Resultat*</th><th>Total</th></tr>
    </thead>
    <tbody></tbody>
    <tfoot>
      <tr><th colspan="3">Summe</th>
      <th id="sr${n}" class="sum"></th>
      <th id="st${n}" class="sum"></th></tr>
    </tfoot>
  </table>`;
  const tb=c.querySelector("tbody");
  for(let i=1;i<=4;i++){
    tb.innerHTML+=`
    <tr>
      <td>${i}</td>
      <td><input></td>
      <td><input type="number"></td>
      <td><input type="number" class="res"></td>
      <td class="tot"></td>
    </tr>`;
  }
  tb.querySelectorAll(".res").forEach(i=>i.oninput=()=>calc(n));
  document.getElementById("groups").appendChild(c);
}

function calc(n){
  let sum=0;
  document.querySelectorAll(
    `#groups .card:nth-child(${n}) .res`
  ).forEach(i=>{
    const v=parseInt(i.value)||0;
    i.parentElement.querySelector(".tot").textContent=v||"";
    sum+=v;
  });
  document.getElementById("sr"+n).textContent=sum||"";
  document.getElementById("st"+n).textContent=sum||"";
  updateWinner();
}

function updateWinner(){
  const t1=+sr1.textContent||0;
  const t2=+sr2.textContent||0;
  const w=document.getElementById("winner");
  w.className="winner";
  if(!t1 && !t2){w.textContent="Noch keine Resultate";w.classList.add("none");return;}
  if(t1===t2){w.textContent="ü§ù Unentschieden";w.classList.add("draw");}
  else if(t1>t2){w.textContent="üèÜ Sieger: Gruppe 1 ("+t1+")";w.classList.add("g1");}
  else{w.textContent="üèÜ Sieger: Gruppe 2 ("+t2+")";w.classList.add("g2");}
}

/* ====== SENDEN ====== */
document.getElementById("sendBtn").onclick=async()=>{
  const data={
    zeit:new Date().toLocaleString(),
    chef:chefName.value,
    email:chefEmail.value,
    gruppe1:g1.value,
    gruppe2:g2.value,
    total1:sr1.textContent||0,
    total2:sr2.textContent||0
  };
  try{
    const r=await fetch(GOOGLE_SHEET_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(data)
    });
    if(r.ok) alert("‚úÖ Resultat gespeichert");
    else alert("‚ùå Fehler beim Speichern");
  }catch(e){
    alert("‚ùå Verbindung fehlgeschlagen");
  }
};

/* ====== START ====== */
loadGroups();
createGroup(1);
createGroup(2);
</script>

</body>
</html>
