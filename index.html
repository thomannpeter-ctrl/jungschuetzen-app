<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Jungsch√ºtzen Amtscup</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="apple-touch-icon.png?v=1">
<link rel="icon" href="apple-touch-icon.png?v=1">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1e3a8a">

<style>
*{box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#eef2f7;margin:0}
.container{max-width:1200px;margin:auto;padding:1rem}
h1{color:#1e3a8a}
h2{color:#1d4ed8}
.card{background:#fff;border-radius:14px;padding:1rem;margin-bottom:1rem;
box-shadow:0 4px 10px rgba(0,0,0,.08)}
.row{display:flex;gap:.75rem;flex-wrap:wrap}
.field{flex:1;min-width:220px}
label{font-size:.8rem;font-weight:600}

input,select{
 width:100%; padding:.45rem;
 border-radius:8px; border:1px solid #cbd5f5;
 font-size:14px;
}

table{width:100%;border-collapse:collapse;font-size:.85rem}
th,td{border:1px solid #e5e7eb;padding:.35rem;text-align:center}
th{background:#dbeafe}

/* Spaltenbreiten */
td.name input{width:100%}
td.year input{width:70px;text-align:center}
td.res input{width:60px;text-align:center}

button{
 border:none;border-radius:999px;
 padding:.9rem;font-size:1rem;
 cursor:pointer;background:#2563eb;
 color:white;width:100%
}

.winner-ok{background:#dcfce7;padding:.7rem;border-radius:12px;font-weight:700}
.winner-none{background:#e5e7eb;padding:.7rem;border-radius:12px}
</style>
</head>

<body>
<div class="container">

<h1>Jungsch√ºtzen Amtscup</h1>

<div class="card">
<h2>1. Gruppenchef</h2>
<div class="row">
 <div class="field"><label>Name *</label><input id="chef"></div>
 <div class="field"><label>E-Mail *</label><input id="email" type="email"></div>
</div>
</div>

<div class="card">
<h2>2. Gruppenauswahl</h2>
<div class="row">
 <div class="field"><label>Gruppe 1 *</label><select id="g1"></select></div>
 <div class="field"><label>Gruppe 2</label><select id="g2"></select></div>
 <div class="field"><label>Gruppe 3</label><select id="g3"></select></div>
</div>
</div>

<div id="groups"></div>

<div class="card">
<h2>Sieger</h2>
<div id="winner" class="winner-none">‚Äì</div>
</div>

<div class="card">
<button onclick="sendResult()">üìß Resultat per Mail senden</button>
</div>

</div>

<script>
const RESULT_EMAIL="thomannpeter@bluewin.ch";
const state={};

async function loadGroups(){
 const r=await fetch("gruppen.txt");
 const list=(await r.text()).split(/\r?\n/).filter(Boolean);
 ["g1","g2","g3"].forEach(id=>{
  const s=document.getElementById(id);
  s.innerHTML="<option value=''>Bitte w√§hlen‚Ä¶</option>";
  list.forEach(g=>s.add(new Option(g,g)));
  s.onchange=()=>selectGroup(id);
 });
}

function selectGroup(id){
 const name=document.getElementById(id).value;
 if(!name) return;
 if(!state[id]) state[id]={name,rows:[{},{},{},{}]};
 renderGroups();
}

function renderGroups(){
 groups.innerHTML="";
 Object.keys(state).forEach((id,i)=>{
  const g=state[id];
  const c=document.createElement("div");
  c.className="card";
  c.innerHTML=`<h2>Sch√ºtzen ‚Äì Gruppe ${i+1}: ${g.name}</h2>
  <table>
   <thead>
    <tr><th>#</th><th>Name</th><th>Jahrgang</th><th>Resultat</th></tr>
   </thead>
   <tbody></tbody>
   <tfoot>
    <tr><th colspan="3">Summe</th><th class="sum">0</th></tr>
   </tfoot>
  </table>`;
  const tb=c.querySelector("tbody");

  g.rows.forEach((r,idx)=>{
   const tr=document.createElement("tr");
   tr.innerHTML=`
    <td>${idx+1}</td>
    <td class="name"><input value="${r.n||""}"></td>
    <td class="year"><input value="${r.y||""}"></td>
    <td class="res"><input value="${r.r||""}"></td>`;
   const inputs=tr.querySelectorAll("input");
   inputs[0].oninput=e=>r.n=e.target.value;
   inputs[1].oninput=e=>r.y=e.target.value;
   inputs[2].oninput=e=>{
     r.r=e.target.value;
     updateSum(c,g);
   };
   tb.appendChild(tr);
  });

  groups.appendChild(c);
  updateSum(c,g);
 });
 calcWinner();
}

function updateSum(card,g){
 const s=g.rows.reduce((a,b)=>a+(+b.r||0),0);
 card.querySelector(".sum").textContent=s;
 calcWinner();
}

function calcWinner(){
 const arr=Object.values(state)
   .map(g=>({n:g.name,t:g.rows.reduce((a,b)=>a+(+b.r||0),0)}))
   .filter(x=>x.t>0);

 if(arr.length<2){
  winner.textContent="‚Äì";
  winner.className="winner-none";
  return;
 }

 arr.sort((a,b)=>b.t-a.t);
 if(arr.length===2)
  winner.innerHTML=`üèÜ Sieger: ${arr[0].n} (${arr[0].t})<br>‚ùå Verlierer: ${arr[1].n} (${arr[1].t})`;
 else
  winner.innerHTML=`üèÜ Sieger: ${arr[0].n} & ${arr[1].n}<br>‚ùå Verlierer: ${arr[2].n}`;
 winner.className="winner-ok";
}

function sendResult(){
 if(!chef.value||!email.value){
  alert("Name und E-Mail sind Pflichtfelder.");
  return;
 }
 if(!Object.keys(state).length){
  alert("Mindestens eine Gruppe w√§hlen.");
  return;
 }
 location.href=`mailto:${RESULT_EMAIL}?subject=Jungsch√ºtzen Amtscup Resultat`;
}

loadGroups();
</script>
</body>
</html>
