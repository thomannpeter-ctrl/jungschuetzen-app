<!doctype html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Amtscup â€“ Cup-Duell (bis zu drei Gruppen)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
*{box-sizing:border-box}
body{font-family:system-ui,sans-serif;background:#eef2f7;margin:0;color:#111827}
.container{max-width:1100px;margin:auto;padding:1rem}
h1{color:#1e3a8a}
h2{color:#1d4ed8}
.card{background:#fff;border-radius:12px;padding:1rem 1.25rem;box-shadow:0 4px 10px rgba(15,23,42,.08);margin-bottom:1rem}
.row{display:flex;flex-wrap:wrap;gap:.75rem}
.field{flex:1;min-width:180px}
label{font-size:.8rem;font-weight:600}
input,select{width:100%;padding:.45rem;border-radius:8px;border:1px solid #cbd5f5}
table{width:100%;border-collapse:collapse;font-size:.85rem}
th,td{border:1px solid #e5e7eb;padding:.35rem;text-align:center}
th{background:#dbeafe}
.sum-cell{background:#f3f4f6;font-weight:600}
.winner-box{padding:.6rem;border-radius:999px;font-weight:600}
.winner-none{background:#e5e7eb}
.winner-g1{background:#dcfce7;color:#166534}
.winner-g2{background:#dbeafe;color:#1d4ed8}
.winner-g3{background:#fee2e2;color:#b91c1c}
.winner-draw{background:#fef9c3;color:#854d0e}
.error{background:#fee2e2;border-color:#dc2626}
</style>
</head>

<body>
<div class="container">
<h1>Amtscup â€“ Cup-Duell</h1>

<div class="card">
<h2>1. Gruppenchef & Gruppen</h2>
<div class="row">
<div class="field"><label>Name</label><input id="chefName"></div>
<div class="field"><label>E-Mail</label><input id="chefEmail" type="email"></div>
</div>
<div class="row">
<div class="field"><label>Gruppe 1</label><select id="g1"></select></div>
<div class="field"><label>Gruppe 2</label><select id="g2"></select></div>
<div class="field"><label>Gruppe 3 (optional)</label><select id="g3"></select></div>
</div>
<button id="toggleG3">âž• 3. Gruppe hinzufÃ¼gen</button>
</div>

<div id="groups"></div>

<div class="card">
<h2>Vergleich & Sieger</h2>
<div id="winner" class="winner-box winner-none">Noch keine Resultate</div>
</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const RESULT_EMAIL="thomannpeter@bluewin.ch";
let g3=false;

function parseGroups(t){
return t.split(/\r?\n/).map(l=>l.trim()).filter(l=>l && !l.startsWith("#"));
}

async function loadGroups(){
const r=await fetch("gruppen.txt?ts="+Date.now(),{cache:"no-store"});
const g=parseGroups(await r.text());
["g1","g2","g3"].forEach(id=>{
const s=document.getElementById(id);
s.innerHTML="<option value=''>Bitte wÃ¤hlen â€¦</option>";
g.forEach(x=>{const o=document.createElement("option");o.value=o.textContent=x;s.appendChild(o);});
});
}

function createGroup(n){
const c=document.createElement("div");
c.className="card";
c.innerHTML=`<h2>SchÃ¼tzen â€“ Gruppe ${n}</h2>
<table><thead><tr>
<th>SchÃ¼tze</th><th>Name*</th><th>Jahrgang*</th><th>Resultat*</th><th>Total</th>
</tr></thead><tbody></tbody>
<tfoot><tr><th colspan="3">Summe</th><th id="sr${n}" class="sum-cell"></th><th id="st${n}" class="sum-cell"></th></tr></tfoot></table>`;
const tb=c.querySelector("tbody");
for(let i=1;i<=4;i++){
tb.innerHTML+=`<tr>
<td>${i}</td>
<td><input></td>
<td><input type="number"></td>
<td><input type="number" class="res"></td>
<td class="tot"></td>
</tr>`;
}
tb.querySelectorAll(".res").forEach(i=>i.oninput=()=>calc(n));
document.getElementById("groups").appendChild(c);
}

function calc(n){
let s=0;
document.querySelectorAll(`#groups .card:nth-child(${n}) .res`).forEach(i=>{
const v=parseInt(i.value)||0;
i.parentElement.querySelector(".tot").textContent=v||"";
s+=v;
});
document.getElementById("sr"+n).textContent=s||"";
document.getElementById("st"+n).textContent=s||"";
updateWinner();
}

function updateWinner(){
const t=[
{n:1,v:+sr1.textContent||0},
{n:2,v:+sr2.textContent||0},
...(g3?[{n:3,v:+sr3.textContent||0}]:[])
].filter(x=>x.v>0);
const b=document.getElementById("winner");
if(!t.length){b.textContent="Noch keine Resultate";b.className="winner-box winner-none";return;}
t.sort((a,b)=>b.v-a.v);
const top=t[0];
const tied=t.filter(x=>x.v===top.v);
if(tied.length>1){
b.textContent="ðŸ¤ Unentschieden";b.className="winner-box winner-draw";
}else{
b.textContent="ðŸ† Sieger Gruppe "+top.n+" (Total "+top.v+")";
b.className="winner-box winner-g"+top.n;
}
}

document.getElementById("toggleG3").onclick=()=>{
if(!g3){g3=true;createGroup(3);document.getElementById("toggleG3").textContent="3. Gruppe entfernen";}
else{location.reload();}
};

loadGroups();
createGroup(1);
createGroup(2);
</script>
</body>
</html>
